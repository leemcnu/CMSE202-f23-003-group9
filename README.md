# CMSE202-f23-003-group9
Can the first half of the NHL season predict who will win the Stanley cup

Liam McNulty, Cameron Wilson, Jack Robertson, & Roger Heinlen

For our CMSE 202 Final Project, we chose to tackle how closely we could predict the Stanley Cup winner. The question initially piqued our interest mostly because we all share a passion for hockey but also because of the possibility of being able to answer the question. Going in, we had our doubts about whether or not we would be able to answer such a complex data science question. After all, there is a reason that sports betting exists, if we were able to correctly predict the winner, we would be able to make a lot of money. We got started by planning out the different ways that we would approach the problem using methods learned in the class. We decided it was best to try many different data models to see if we could find one that worked better than the others. After much deliberation, we decided to approach the problem by using 4 different modeling techniques: Perceptron, TensorFlow, OLS, and SVM. 

After deciding on which of the 4 models we were each going to tackle, we went our separate ways to try and see what we could come up with. During the next class period, we got together and discussed our findings. We had each found it relatively hard to find a correlation between the data that was significant. After discussing the next steps, we decided to include another trophy for comparison. The Presidents Cup is given to the NHL team with the most points at the end of the season (with certain tiebreakers to help in deliberation). This cup would help to provide a comparison between the two cups as its winner was determined statistically. Unlike the Stanley Cup, Which involves many factors that are not easily graphed, the Presidents Cup was solely based on points. It is also important to know that other attributes influence the number of points a team receives (Wins, Losses, Goals, etc.). We decided that modeling both outcomes would give us a deeper understanding of the analysis that was happening behind each of the models discussed above. 

The OLS method calculates values of m for each variable and an intercept for a y = mx+b style equation that minimizes the sum of the squared differences between observed values of the dependent variable and the value predicted by the equation. With the OLS Model attempting to answer this original question became incredibly difficult due to multiple reasons. For one, linear regression models are not the best method to predict a binary variable (win vs non-winner). also the data used is regular season data for an 82 game stretch, whereas the playoffs can be anywhere from 4 to 28 games for a team. During this process, I decided to remove all the seasons with less than 82 games. This is mainly because the variable values would not change due to the number of games played, but the amount of points would. Also these shortened seasons have a lot of other noise around them which can not be analyzed through this data and do not apply to 99% of NHL seasons. Due to the lack of success of predicting a stanley cup winner, I moved my dependent variable to points instead. Due to the regular season data being directly associated with the amount of points, this model was a lot more successful. Through this model I found that goals for, goals against, net penalty kill%, shots/gp, shots against/gp, and FOW% are the most important variables to try to control to have a successful NHL team. One interesting variable is net penalty kill% as it has a negative coefficient even though a higher value is considered “better.” Logically, these variables should not correlate in this way. After creating this model I used the current season's data to predict the team with the most points for this season. The algorithm predicted the Vancouver Canucks would be the winners with 109 points at the end of the season. One limitation is that the algorithm uses goals scored and not any standardized per game measurement, throwing off the point total.


Group 9 Semester Project Jack Robertson.ipynb: Loaded in Dataset using pd.read_csv(). Then used drop() function to delete rows that were not helpful for SVMs. Created two separate binary Dataframes for the Stanley Cup winners and the President's Cup winner. Split the data using train_test_split() with 25% testing data. Then, ran a grid search to determine the best hyperparameters for the SVM model using GridsearchCV. Trained the model using SVC and fit the model to the data. Made predictions using svm.predict(), and found the accuracy by using accuracy_score(Test, predicted). Created Confusion matrix, and displayed it using seaborn.heatmap(). Created two SVM models, one for Stanley Cup winners, and one for President's Cup winners.

Group 9 - Liam.ipynb: The code in Group 9 - Liam.ipynb is very simple to run, as it runs from top to bottom without any issues. Following imports and data cleaning, a model is created to predict the winner of the Stanley Cup using team statistics as variables. Due to this attempt lacking any success, the dependent variable is changed to Points and all independent variables that are directly correlated with points (wins, losses, OT, regulation W, etc.) are removed from the linear model. Following the creation of the full model, it is reduced to create a model with less features. The final code block uses this reduced model to create a graph showing fitted values vs residuals to demonstrate the fit of this model. Following this data from the current season is imported to use the created algorithm to make a prediction for this season. 

Group 9 - Cameron.ipynb: The Perceptron portion of the code runs as you would expect. The first cell contains the definition of the Perceptron class (as noted in the docstring, it is from instructor solution InClass #18). In the second code cell, The file is opened and parsed and the data from the .csv file is extracted. The data is then put into two lists representing the data for the Presidents Cup and the Stanley Cup. During this process, Wins and Points are selected for analysis. The following two code cells break up the lists into seasons based on index. This will be helpful for individual season analysis when graphing. Then, the Perceptron instances are run for each of the main lists (President’s Cup and Stanley Cup). The last two code cells generate graphs for the data mapped to the perceptron instances. There are also 3 graphs displaying individual season data. 

Group9 - Roger.ipynb: In my section of the project I created a TensorFlow class that took in a variety of parameters to model the data. The class has a process data method and a model method. The process data method prepares the data for the TensorFlow model. It also uses PCAs to remove unnecessary data. Then after the creation of the class, I import the data and sort it in the cell below. After that, I created the features and target variables for predicting the Stanley Cup winner. The next two cells model the data and return the r-squared value. Then I create features and a target for modeling the Presidents Cup data. Once the data is modeled I print the accuracy of the predictions. 
